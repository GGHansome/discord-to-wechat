# Discord to WeChat Bridge - æ¶æ„è¯´æ˜

## ğŸ“ ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      discord_to_wechat.py                        â”‚
â”‚                          (ä¸»ç¨‹åº)                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚        DiscordToWechatBridge (æ¡¥æ¥å™¨)                   â”‚   â”‚
â”‚  â”‚  - æ•´åˆç›‘å¬å™¨å’Œå‘é€å™¨                                     â”‚   â”‚
â”‚  â”‚  - é…ç½®éªŒè¯                                              â”‚   â”‚
â”‚  â”‚  - æ¶ˆæ¯è·¯ç”±                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                    â”‚
           â”‚ åˆ›å»º                                â”‚ åˆ›å»º
           â–¼                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   discord_listener.py    â”‚      â”‚    message_sender.py       â”‚
â”‚   (Discordç›‘å¬å™¨)         â”‚      â”‚    (å‘é€å™¨æŠ½è±¡åŸºç±»)         â”‚
â”‚                          â”‚      â”‚                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  DiscordListener     â”‚ â”‚      â”‚  â”‚  MessageSender       â”‚ â”‚
â”‚ â”‚  ----------------    â”‚ â”‚      â”‚  â”‚  -------------       â”‚ â”‚
â”‚ â”‚  + init_chrome()    â”‚ â”‚      â”‚  â”‚  + login()           â”‚ â”‚
â”‚ â”‚  + login_discord()  â”‚ â”‚      â”‚  â”‚  + send_message()    â”‚ â”‚
â”‚ â”‚  + monitor_messages()â”‚ â”‚      â”‚  â”‚  + keep_alive()      â”‚ â”‚
â”‚ â”‚  + extract_message()â”‚ â”‚      â”‚  â”‚  + cleanup()         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  ä½¿ç”¨ Selenium:          â”‚                   â”‚
â”‚  - Chromeè‡ªåŠ¨åŒ–          â”‚                   â”‚ ç»§æ‰¿
â”‚  - å¤šé¢‘é“è½®è¯¢            â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  - æ¶ˆæ¯æå–              â”‚       â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â–¼                       â–¼
           â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚              â”‚sender_wechat.py  â”‚  â”‚sender_enterprise     â”‚
           â”‚              â”‚(å¾®ä¿¡ä¸ªäººå·å‘é€å™¨) â”‚  â”‚_wechat.py           â”‚
           â”‚              â”‚                  â”‚  â”‚(ä¼ä¸šå¾®ä¿¡å‘é€å™¨)      â”‚
           â”‚              â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
           â”‚              â”‚ â”‚WechatSender  â”‚ â”‚  â”‚ â”‚EnterpriseWechat  â”‚ â”‚
           â”‚              â”‚ â”‚--------------â”‚ â”‚  â”‚ â”‚Sender            â”‚ â”‚
           â”‚              â”‚ â”‚ä½¿ç”¨ itchat   â”‚ â”‚  â”‚ â”‚-----------------â”‚ â”‚
           â”‚              â”‚ â”‚æ‰«ç ç™»å½•      â”‚ â”‚  â”‚ â”‚ä½¿ç”¨ Webhook API â”‚ â”‚
           â”‚              â”‚ â”‚ä¸ªäººèŠå¤©è½¬å‘  â”‚ â”‚  â”‚ â”‚å‘é€åˆ°ä¼ä¸šå¾®ä¿¡ç¾¤  â”‚ â”‚
           â”‚              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
           â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                       â”‚                       â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   config.py      â”‚
                    â”‚   (é…ç½®æ–‡ä»¶)      â”‚
                    â”‚                  â”‚
                    â”‚ - SENDER_TYPE    â”‚
                    â”‚ - DISCORD_URLS   â”‚
                    â”‚ - WECHAT_CONFIG  â”‚
                    â”‚ - WEBHOOK_URL    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ æ¶ˆæ¯æµç¨‹å›¾

```
Discordé¢‘é“
    â”‚
    â”‚ 1. Seleniumè‡ªåŠ¨åŒ–ç›‘å¬
    â–¼
DiscordListener
    â”‚ æå–æ¶ˆæ¯ä¿¡æ¯
    â”‚ {username, content, timestamp, attachments}
    â”‚
    â”‚ 2. å›è°ƒå‡½æ•°
    â–¼
DiscordToWechatBridge
    â”‚ è·¯ç”±æ¶ˆæ¯
    â”‚
    â”‚ 3. è°ƒç”¨å‘é€å™¨
    â–¼
MessageSender
    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                 â”‚                 â”‚
    â–¼                 â–¼                 â–¼
WechatSender   EnterpriseWechatSender  ...æ›´å¤šå‘é€å™¨
    â”‚                 â”‚
    â”‚ itchatå‘é€      â”‚ Webhook API
    â–¼                 â–¼
å¾®ä¿¡ä¸ªäººèŠå¤©      ä¼ä¸šå¾®ä¿¡ç¾¤
```

## ğŸ¯ æ ¸å¿ƒè®¾è®¡æ¨¡å¼

### 1. ç­–ç•¥æ¨¡å¼ (Strategy Pattern)
**ç›®çš„**ï¼šè®©å‘é€æ–¹å¼å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€é€‰æ‹©

```python
# message_sender.py - æŠ½è±¡ç­–ç•¥
class MessageSender(ABC):
    @abstractmethod
    def send_message(self, message_info, channel_name):
        pass

# sender_wechat.py - å…·ä½“ç­–ç•¥A
class WechatSender(MessageSender):
    def send_message(self, message_info, channel_name):
        itchat.send(...)  # å¾®ä¿¡å®ç°

# sender_enterprise_wechat.py - å…·ä½“ç­–ç•¥B
class EnterpriseWechatSender(MessageSender):
    def send_message(self, message_info, channel_name):
        requests.post(...)  # ä¼ä¸šå¾®ä¿¡å®ç°

# discord_to_wechat.py - ä¸Šä¸‹æ–‡
bridge = DiscordToWechatBridge(sender_type="wechat")  # åŠ¨æ€é€‰æ‹©
```

### 2. è§‚å¯Ÿè€…æ¨¡å¼ (Observer Pattern)
**ç›®çš„**ï¼šç›‘å¬å™¨å‘ç°æ–°æ¶ˆæ¯æ—¶é€šçŸ¥å‘é€å™¨

```python
# discord_listener.py - ä¸»é¢˜
class DiscordListener:
    def __init__(self, on_new_message):  # æ³¨å†Œè§‚å¯Ÿè€…
        self.on_new_message = on_new_message
    
    def monitor_messages(self):
        # å‘ç°æ–°æ¶ˆæ¯
        self.on_new_message(message_info, channel_name)  # é€šçŸ¥

# discord_to_wechat.py - è§‚å¯Ÿè€…
class DiscordToWechatBridge:
    def _on_new_message(self, message_info, channel_name):
        self.sender.send_message(...)  # å“åº”é€šçŸ¥
```

### 3. å•ä¸€èŒè´£åŸåˆ™ (Single Responsibility)
æ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä»¶äº‹ï¼š

- `discord_listener.py` - åªè´Ÿè´£ç›‘å¬Discord
- `sender_wechat.py` - åªè´Ÿè´£å¾®ä¿¡å‘é€
- `sender_enterprise_wechat.py` - åªè´Ÿè´£ä¼ä¸šå¾®ä¿¡å‘é€
- `message_sender.py` - åªå®šä¹‰æ¥å£è§„èŒƒ
- `discord_to_wechat.py` - åªè´Ÿè´£åè°ƒæ•´åˆ

### 4. å¼€é—­åŸåˆ™ (Open-Closed Principle)
**å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­**

æ·»åŠ æ–°å‘é€æ–¹å¼æ—¶ï¼š
- âœ… åªéœ€æ–°å»ºæ–‡ä»¶ï¼Œç»§æ‰¿ `MessageSender`
- âœ… æ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç 
- âœ… åœ¨ä¸»ç¨‹åºä¸­æ³¨å†Œå³å¯

ç¤ºä¾‹ - æ·»åŠ é’‰é’‰å‘é€å™¨ï¼š
```python
# 1. åˆ›å»º sender_dingtalk.py (æ–°å¢)
class DingtalkSender(MessageSender):
    def send_message(...):
        # é’‰é’‰å®ç°
        pass

# 2. åœ¨ä¸»ç¨‹åºä¸­æ³¨å†Œ (å°æ”¹åŠ¨)
def _create_sender(self, sender_type, ...):
    if sender_type == "dingtalk":  # æ–°å¢
        return DingtalkSender(...)
    # å…¶ä»–ä»£ç ä¸å˜
```

## ğŸ“¦ æ¨¡å—ä¾èµ–å…³ç³»

```
discord_to_wechat.py (ä¸»ç¨‹åº)
    â”œâ”€â”€ config.py (é…ç½®)
    â”œâ”€â”€ discord_listener.py (ç›‘å¬å™¨)
    â”‚   â””â”€â”€ selenium, webdriver_manager
    â””â”€â”€ message_sender.py (æŠ½è±¡åŸºç±»)
        â”œâ”€â”€ sender_wechat.py (å¾®ä¿¡å‘é€å™¨)
        â”‚   â””â”€â”€ itchat, threading
        â””â”€â”€ sender_enterprise_wechat.py (ä¼ä¸šå¾®ä¿¡å‘é€å™¨)
            â””â”€â”€ requests
```

## ğŸ”§ æ‰©å±•ç‚¹

### 1. æ·»åŠ æ–°çš„æ¶ˆæ¯æ¥æº
å½“å‰åªæ”¯æŒDiscordï¼Œå¯ä»¥æ‰©å±•ï¼š
- Telegramç›‘å¬å™¨
- Slackç›‘å¬å™¨
- IRCç›‘å¬å™¨

åˆ›å»º `xxx_listener.py`ï¼Œå®ç°ç›¸åŒçš„å›è°ƒæ¥å£å³å¯ã€‚

### 2. æ·»åŠ æ–°çš„å‘é€æ–¹å¼
å½“å‰æ”¯æŒå¾®ä¿¡å’Œä¼ä¸šå¾®ä¿¡ï¼Œå¯ä»¥æ‰©å±•ï¼š
- é’‰é’‰æœºå™¨äºº
- é£ä¹¦æœºå™¨äºº
- Telegram Bot
- é‚®ä»¶å‘é€

åˆ›å»º `sender_xxx.py`ï¼Œç»§æ‰¿ `MessageSender` å³å¯ã€‚

### 3. æ¶ˆæ¯è¿‡æ»¤å’Œå¤„ç†
å¯ä»¥åœ¨ `DiscordToWechatBridge._on_new_message` ä¸­æ·»åŠ ï¼š
- å…³é”®è¯è¿‡æ»¤
- ç”¨æˆ·é»‘/ç™½åå•
- æ¶ˆæ¯æ ¼å¼è½¬æ¢
- å†…å®¹å®¡æ ¸

### 4. æ¶ˆæ¯æŒä¹…åŒ–
å¯ä»¥åœ¨ç›‘å¬å™¨ä¸­æ·»åŠ ï¼š
- æ•°æ®åº“å­˜å‚¨
- æ¶ˆæ¯é˜Ÿåˆ—
- æ—¥å¿—å½’æ¡£

## ğŸ“Š æ€§èƒ½è€ƒè™‘

### Discordç›‘å¬
- **è½®è¯¢é—´éš”**ï¼š`CHECK_INTERVAL` æ§åˆ¶é¢‘ç‡ï¼ˆé»˜è®¤3ç§’ï¼‰
- **å¤šé¢‘é“æ”¯æŒ**ï¼šé¡ºåºè½®è¯¢ï¼Œå•çº¿ç¨‹æ¨¡å¼
- **ä¼˜åŒ–æ–¹å‘**ï¼šå¯æ”¹ä¸ºå¤šçº¿ç¨‹å¹¶å‘ç›‘å¬

### æ¶ˆæ¯å‘é€
- **å¾®ä¿¡ä¸ªäººå·**ï¼šæ— é¢‘ç‡é™åˆ¶ï¼Œä½†éœ€ä¿æŒåœ¨çº¿
- **ä¼ä¸šå¾®ä¿¡**ï¼šé™åˆ¶20æ¡/åˆ†é’Ÿ
- **ä¼˜åŒ–æ–¹å‘**ï¼šå¯æ·»åŠ æ¶ˆæ¯é˜Ÿåˆ—å’Œé™æµ

### å†…å­˜å ç”¨
- **Chrome**ï¼š~200-300MBï¼ˆæ— å¤´æ¨¡å¼å¯é™ä½ï¼‰
- **Python**ï¼š~50-100MB
- **æ€»è®¡**ï¼šå»ºè®®æœåŠ¡å™¨è‡³å°‘1GBå†…å­˜

## ğŸ›¡ï¸ é”™è¯¯å¤„ç†

### ç½‘ç»œé”™è¯¯
- Discordè¿æ¥å¤±è´¥ï¼šè‡ªåŠ¨é‡è¯•ï¼Œåˆ·æ–°é¡µé¢
- å‘é€å¤±è´¥ï¼šè®°å½•æ—¥å¿—ï¼Œè·³è¿‡è¯¥æ¶ˆæ¯

### ç™»å½•å¤±æ•ˆ
- Discordï¼šè‡ªåŠ¨ä¿å­˜ç™»å½•çŠ¶æ€ï¼ˆ`chrome_data/`ï¼‰
- å¾®ä¿¡ï¼šçƒ­ç™»å½•æœºåˆ¶ï¼ˆ`itchat.pkl`ï¼‰
- ä¼ä¸šå¾®ä¿¡ï¼šæ— éœ€ç™»å½•ï¼ŒWebhookæ°¸ä¹…æœ‰æ•ˆ

### å¼‚å¸¸æ¢å¤
- ç›‘å¬å™¨é”™è¯¯ï¼šè¿ç»­5æ¬¡é”™è¯¯ååˆ·æ–°é¡µé¢
- å‘é€å™¨é”™è¯¯ï¼šè®°å½•æ—¥å¿—ï¼Œç»§ç»­ç›‘å¬
- ç¨‹åºå´©æºƒï¼šè‡ªåŠ¨ä¿å­˜çŠ¶æ€ï¼Œé‡å¯åç»§ç»­

## ğŸ“ ä»£ç è´¨é‡

### æ—¥å¿—ç³»ç»Ÿ
- ç»Ÿä¸€ä½¿ç”¨ `logging` æ¨¡å—
- åŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°å’Œæ–‡ä»¶
- åˆ†çº§è®°å½•ï¼ˆINFO/WARNING/ERRORï¼‰

### ç±»å‹æç¤º
- ä½¿ç”¨ Type Hints å¢å¼ºå¯è¯»æ€§
- æ˜ç¡®å‡½æ•°å‚æ•°å’Œè¿”å›å€¼ç±»å‹

### æ–‡æ¡£æ³¨é‡Š
- æ¯ä¸ªç±»å’Œæ–¹æ³•éƒ½æœ‰ docstring
- è¯´æ˜å‚æ•°å«ä¹‰å’Œè¿”å›å€¼

### æ¨¡å—åŒ–
- é«˜å†…èšï¼šæ¯ä¸ªæ¨¡å—åŠŸèƒ½å•ä¸€
- ä½è€¦åˆï¼šæ¨¡å—é—´ä¾èµ–æœ€å°åŒ–
- æ˜“æµ‹è¯•ï¼šæ¯ä¸ªæ¨¡å—å¯ç‹¬ç«‹æµ‹è¯•

---

**è®¾è®¡ç†å¿µ**ï¼šç®€å•ã€æ¸…æ™°ã€å¯æ‰©å±•

